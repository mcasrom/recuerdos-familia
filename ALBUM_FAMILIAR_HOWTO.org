#+TITLE: √Ålbum Familiar - Gu√≠a Completa de Uso
#+AUTHOR: Sistema de √Ålbum Fotogr√°fico Familiar
#+DATE: [2026-02-14 Vie]
#+DESCRIPTION: Documentaci√≥n completa del sistema de √°lbum familiar con Hugo y GitHub Pages
#+KEYWORDS: hugo, fotograf√≠a, √°lbum, familia, github-pages, dietpi, odroid
#+LANGUAGE: es
#+STARTUP: overview indent
#+OPTIONS: toc:3 num:t ^:nil
#+PROPERTY: header-args :eval never-export

* Tabla de Contenidos :TOC:
- [[#introducci√≥n][Introducci√≥n]]
- [[#arquitectura-del-sistema][Arquitectura del Sistema]]
- [[#instalaci√≥n-inicial][Instalaci√≥n Inicial]]
- [[#gesti√≥n-de-fotograf√≠as][Gesti√≥n de Fotograf√≠as]]
  - [[#tabla-de-tama√±os-recomendados][Tabla de Tama√±os Recomendados]]
  - [[#subir-una-foto-individual][Subir una Foto Individual]]
  - [[#subir-m√∫ltiples-fotos-en-lote][Subir M√∫ltiples Fotos en Lote]]
- [[#estructura-de-directorios][Estructura de Directorios]]
- [[#workflow-completo][Workflow Completo]]
- [[#automatizaci√≥n-con-cron][Automatizaci√≥n con Cron]]
- [[#despliegue-en-github-pages][Despliegue en GitHub Pages]]
- [[#sistema-de-backup][Sistema de Backup]]
- [[#soluci√≥n-de-problemas][Soluci√≥n de Problemas]]
- [[#scripts-disponibles][Scripts Disponibles]]
- [[#configuraci√≥n-avanzada][Configuraci√≥n Avanzada]]

* Introducci√≥n

Este sistema proporciona un √°lbum fotogr√°fico familiar privado, protegido con contrase√±a, desplegado en GitHub Pages y gestionado desde un dispositivo Odroid CE con DietPi.

** Caracter√≠sticas Principales

- üîê Autenticaci√≥n con contrase√±a (SHA-256)
- üì∏ Optimizaci√≥n autom√°tica de im√°genes
- üóÇÔ∏è Organizaci√≥n por fecha (EXIF)
- üöÄ Despliegue autom√°tico a GitHub Pages
- üíæ Sistema de backup autom√°tico
- üì± Dise√±o responsive (m√≥vil, tablet, desktop)
- üîç Filtros por fecha
- üñºÔ∏è Galer√≠a lightbox interactiva

** Requisitos del Sistema

| Componente       | Versi√≥n/Especificaci√≥n |
|------------------+------------------------|
| Sistema Operativo| DietPi (Debian 11/12)  |
| Hardware         | Odroid CE (ARM)        |
| Hugo             | v0.122.0 Extended      |
| ImageMagick      | 7.x                    |
| ExifTool         | Latest                 |
| Git              | 2.x                    |
| Espacio en Disco | Min. 2GB libre         |

* Arquitectura del Sistema

#+BEGIN_SRC plantuml :file album-arquitectura.png :exports results
@startuml
!define RECTANGLE class

skinparam backgroundColor #FEFEFE
skinparam componentStyle rectangle

package "Odroid CE (DietPi)" {
    [C√°mara/USB] as camera
    [fotos_para_subir/] as staging
    [manage_photos.sh] as manage
    [batch_upload.sh] as batch
    [Hugo Generator] as hugo
    [Git Repository] as git
}

package "Procesamiento" {
    [ImageMagick] as imagemagick
    [ExifTool] as exiftool
    [jpegoptim] as jpegoptim
}

package "Almacenamiento Local" {
    database "static/images/" as images {
        [YYYY/MM/foto_full.jpg] as full
        [YYYY/MM/foto_thumb.jpg] as thumb
    }
    database "content/fotos/" as content {
        [YYYY/MM-mes/foto.md] as markdown
    }
    [public/] as public
}

package "GitHub" {
    [Repository] as repo
    [GitHub Actions] as actions
    [GitHub Pages] as pages
}

cloud "Internet" {
    [Navegador Web] as browser
}

package "Backup" {
    database "/mnt/backup/" as backup {
        [album_familiar_*.tar.gz] as backupfile
    }
}

camera --> staging
staging --> manage
staging --> batch
manage --> imagemagick
batch --> imagemagick
imagemagick --> exiftool
exiftool --> jpegoptim
jpegoptim --> full
jpegoptim --> thumb
manage --> markdown
batch --> markdown

full --> hugo
thumb --> hugo
markdown --> hugo
hugo --> public
public --> git
git --> repo
repo --> actions
actions --> pages
pages --> browser

manage --> backup
batch --> backup

note right of staging
  Fotos originales
  Formatos: JPG, PNG
  Sin procesar
end note

note right of images
  Fotos optimizadas
  Max: 1920x1080
  Thumbnails: 400x300
end note

note right of backup
  Backup semanal
  Autom√°tico
  Retenci√≥n: 30 d√≠as
end note

@enduml
#+END_SRC

#+RESULTS:
[[file:album-arquitectura.png]]

* Instalaci√≥n Inicial

** 1. Descargar el Proyecto

#+BEGIN_SRC bash
cd ~
# Descargar desde el paquete proporcionado
unzip album_familiar.zip
# O desde tar.gz
tar -xzf album_familiar.tar.gz

cd album_familiar
#+END_SRC

** 2. Ejecutar Script de Instalaci√≥n

#+BEGIN_SRC bash
chmod +x setup.sh
./setup.sh
#+END_SRC

Este script instalar√°:
- Hugo Extended 0.122.0
- ImageMagick
- ExifTool
- jpegoptim
- Dependencias Python (Pillow)
- Estructura de directorios
- Templates HTML/CSS/JS

** 3. Verificar Instalaci√≥n

#+BEGIN_SRC bash
hugo version
convert --version
exiftool -ver
jpegoptim --version
#+END_SRC

* Gesti√≥n de Fotograf√≠as

** Tabla de Tama√±os Recomendados

| Tipo de Foto          | Resoluci√≥n Original | Optimizada (Full) | Thumbnail | Tama√±o Aproximado |
|-----------------------+---------------------+-------------------+-----------+-------------------|
| C√°mara Profesional    | 6000√ó4000 (24MP)    | 1920√ó1280         | 400√ó267   | ~800KB            |
| C√°mara Compacta       | 4000√ó3000 (12MP)    | 1920√ó1440         | 400√ó300   | ~600KB            |
| Smartphone Moderno    | 4032√ó3024 (12MP)    | 1920√ó1440         | 400√ó300   | ~600KB            |
| Smartphone Antiguo    | 2592√ó1944 (5MP)     | 1920√ó1440         | 400√ó300   | ~400KB            |
| Screenshot/Captura    | Variable            | 1920√ó1080         | 400√ó225   | ~300KB            |
| Foto Escaneada        | 3000√ó2000           | 1920√ó1280         | 400√ó267   | ~500KB            |
|-----------------------+---------------------+-------------------+-----------+-------------------|
| *Recomendaci√≥n*       | < 25MB              | Max 1920√ó1080     | 400√ó300   | 85% JPEG Quality  |

*** Notas sobre Tama√±os

- *Advertencia*: Archivos > 10MB mostrar√°n confirmaci√≥n
- *L√≠mite*: Archivos > 25MB ser√°n rechazados
- *Calidad JPEG*: 85% (√≥ptimo entre calidad y tama√±o)
- *Formato salida*: Siempre JPG (PNG se convierte autom√°ticamente)

** Subir una Foto Individual

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/manage_photos.sh
#+END_SRC

*** Proceso Interactivo

#+BEGIN_EXAMPLE
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë              √ÅLBUM FAMILIAR - GESTI√ìN DE FOTOS                 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Opciones:
  1. üì∏ Subir foto
  2. üóëÔ∏è  Eliminar foto
  3. ‚úèÔ∏è  Editar foto
  4. üìä Estad√≠sticas
  5. üî® Generar sitio
  6. üö™ Salir

Seleccione una opci√≥n: 1

Ruta de la imagen: fotos_para_subir/2024/cumplea√±os.jpg
‚Ñπ Formato detectado: .jpg ‚Üí se convertir√° a .jpg optimizado
‚Ñπ Fecha: 2024-03-15 14:30:00 (marzo 2024)
T√≠tulo: Cumplea√±os de Mar√≠a
Descripci√≥n: Celebraci√≥n familiar
‚úì Optimizado: 2400KB ‚Üí 650KB (ahorro: 73%)
‚úì Foto subida: /images/2024/03/foto_20260214_143000_Abc123_full.jpg
#+END_EXAMPLE

*** Diagrama de Proceso de Subida

#+BEGIN_SRC plantuml :file subida-foto.png :exports results
@startuml
start

:Usuario selecciona foto;

:Script valida formato\n(.jpg, .jpeg, .png);

if (Formato v√°lido?) then (s√≠)
  :Extraer metadata EXIF;
  
  if (¬øTiene fecha EXIF?) then (s√≠)
    :Usar fecha de foto;
  else (no)
    :Usar fecha del archivo;
  endif
  
  :Solicitar t√≠tulo y descripci√≥n;
  
  :Optimizar imagen\n(max 1920x1080, 85% quality);
  
  :Generar thumbnail\n(400x300);
  
  :Crear archivo Markdown;
  
  :Organizar por a√±o/mes;
  
  :‚úì Foto procesada exitosamente;
  
else (no)
  :‚úó Error: Formato no soportado;
  stop
endif

stop
@enduml
#+END_SRC

#+RESULTS:
[[file:subida-foto.png]]

** Subir M√∫ltiples Fotos en Lote

Para procesar carpetas completas:

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/batch_upload.sh
#+END_SRC

*** Ejemplo de Uso

#+BEGIN_EXAMPLE
Este script procesa TODAS las fotos de una carpeta

Ruta de la carpeta con fotos: fotos_para_subir/2024/vacaciones
‚Ñπ Fotos encontradas: 45
T√≠tulo base para todas: Vacaciones Verano 2024
Descripci√≥n com√∫n: Viaje familiar a la playa

¬øProcesar todas las fotos? (s/n): s

Procesando fotos...

‚úì IMG_001.JPG ‚Üí /images/2024/08/foto_20260214_150001_Xyz789_full.jpg
‚úì IMG_002.JPG ‚Üí /images/2024/08/foto_20260214_150005_Def456_full.jpg
‚úì IMG_003.JPG ‚Üí /images/2024/08/foto_20260214_150010_Ghi123_full.jpg
...

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                  PROCESAMIENTO COMPLETADO                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Resumen:
  ‚úì Exitosas: 45
  ‚úó Fallidas: 0
  üìÅ Carpeta: fotos_para_subir/2024/vacaciones

Siguiente paso:
  ./scripts/deploy.sh
#+END_EXAMPLE

* Estructura de Directorios

#+BEGIN_SRC
~/album_familiar/
‚îú‚îÄ‚îÄ config.toml                    # Configuraci√≥n Hugo
‚îú‚îÄ‚îÄ setup.sh                       # Script instalaci√≥n inicial
‚îú‚îÄ‚îÄ README.md                      # Documentaci√≥n principal
‚îú‚îÄ‚îÄ HOWTO.md                       # Gu√≠a r√°pida
‚îú‚îÄ‚îÄ GUIA_STORAGE_FOTOS.txt        # Gu√≠a de almacenamiento
‚îú‚îÄ‚îÄ GUIA_FORMATOS_IMAGEN.txt      # Formatos soportados
‚îÇ
‚îú‚îÄ‚îÄ fotos_para_subir/              # üì∏ Staging - Fotos originales
‚îÇ   ‚îú‚îÄ‚îÄ 2024/
‚îÇ   ‚îú‚îÄ‚îÄ 2025/
‚îÇ   ‚îî‚îÄ‚îÄ 2026/
‚îÇ
‚îú‚îÄ‚îÄ content/                       # üìÑ Contenido Hugo
‚îÇ   ‚îî‚îÄ‚îÄ fotos/
‚îÇ       ‚îú‚îÄ‚îÄ 2024/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ 01-enero/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ foto_xxx.md
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ 02-febrero/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ       ‚îî‚îÄ‚îÄ _index.md
‚îÇ
‚îú‚îÄ‚îÄ static/                        # üåê Archivos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ images/                    # Fotos optimizadas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ placeholder.jpg        # Thumbnail por defecto
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 2024/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ 01/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ foto_xxx_full.jpg   (1920x1080)
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ foto_xxx_thumb.jpg  (400x300)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ auth.js                # Autenticaci√≥n
‚îÇ       ‚îú‚îÄ‚îÄ gallery.js             # Galer√≠a lightbox
‚îÇ       ‚îî‚îÄ‚îÄ date-filter.js         # Filtros
‚îÇ
‚îú‚îÄ‚îÄ layouts/                       # üé® Templates Hugo
‚îÇ   ‚îú‚îÄ‚îÄ _default/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ baseof.html           # Template base
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ list.html             # Lista de fotos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ single.html           # Foto individual
‚îÇ   ‚îî‚îÄ‚îÄ partials/
‚îÇ       ‚îú‚îÄ‚îÄ header.html
‚îÇ       ‚îú‚îÄ‚îÄ footer.html
‚îÇ       ‚îî‚îÄ‚îÄ auth.html             # Pantalla login
‚îÇ
‚îú‚îÄ‚îÄ scripts/                       # üõ†Ô∏è Scripts de gesti√≥n
‚îÇ   ‚îú‚îÄ‚îÄ manage_photos.sh          # Gesti√≥n individual
‚îÇ   ‚îú‚îÄ‚îÄ batch_upload.sh           # Procesamiento masivo
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh                 # Despliegue GitHub
‚îÇ   ‚îú‚îÄ‚îÄ backup_album.sh           # Backup manual
‚îÇ   ‚îî‚îÄ‚îÄ weekly_deploy.sh          # Deployment autom√°tico
‚îÇ
‚îú‚îÄ‚îÄ logs/                          # üìã Logs del sistema
‚îÇ   ‚îú‚îÄ‚îÄ management.log
‚îÇ   ‚îú‚îÄ‚îÄ optimization.log
‚îÇ   ‚îú‚îÄ‚îÄ deployment.log
‚îÇ   ‚îú‚îÄ‚îÄ backup.log
‚îÇ   ‚îî‚îÄ‚îÄ weekly_deploy.log
‚îÇ
‚îú‚îÄ‚îÄ .github/                       # ‚öôÔ∏è GitHub Actions
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ hugo.yml              # CI/CD workflow
‚îÇ
‚îî‚îÄ‚îÄ public/                        # üöÄ Sitio generado (no en Git)
    ‚îî‚îÄ‚îÄ (archivos HTML generados)
#+END_SRC

* Workflow Completo

#+BEGIN_SRC plantuml :file workflow-completo.png :exports results
@startuml
skinparam backgroundColor #FEFEFE

actor Usuario
participant "fotos_para_subir" as staging
participant "manage_photos.sh" as manage
participant "ImageMagick\n+ExifTool" as tools
participant "static/images" as images
participant "content/fotos" as content
participant "Hugo" as hugo
participant "Git" as git
participant "GitHub" as github
participant "GitHub Actions" as actions
participant "GitHub Pages" as pages

== Carga de Fotos ==
Usuario -> staging: Copiar fotos originales
Usuario -> manage: ./manage_photos.sh

== Procesamiento ==
manage -> tools: Optimizar imagen
tools -> images: Guardar foto_full.jpg (1920x1080)
tools -> images: Guardar foto_thumb.jpg (400x300)
manage -> content: Crear archivo .md con metadata

== Generaci√≥n Local (Opcional) ==
Usuario -> hugo: hugo server
hugo -> Usuario: http://192.168.1.147:1313

== Despliegue ==
Usuario -> git: git add .
Usuario -> git: git commit
Usuario -> git: git push
git -> github: Subir cambios

== CI/CD Autom√°tico ==
github -> actions: Trigger workflow
actions -> actions: Instalar Hugo
actions -> actions: Generar sitio est√°tico
actions -> pages: Desplegar
pages -> Usuario: https://mcasrom.github.io/recuerdos-familia/

note right of pages
  Password: Recuerdos@FAMILIA#
  77 fotos disponibles
  Filtros por fecha
  Galer√≠a interactiva
end note

@enduml
#+END_SRC

#+RESULTS:
[[file:workflow-completo.png]]

* Automatizaci√≥n con Cron

** Configuraci√≥n de Tareas Programadas

El sistema incluye automatizaci√≥n mediante =crontab= para backup y deployment semanal.

*** Ver Crontab Actual

#+BEGIN_SRC bash
crontab -l
#+END_SRC

*** Configuraci√≥n Recomendada

#+BEGIN_SRC crontab
# Deployment autom√°tico semanal del √°lbum familiar (incluye backup)
# Domingos a las 3:00 AM
0 3 * * 0 /home/dietpi/album_familiar/scripts/weekly_deploy.sh

# Limpieza de logs antiguos (primer d√≠a de cada mes 4:00 AM)
0 4 1 * * find /home/dietpi/album_familiar/logs -name "*.log" -type f -mtime +90 -delete
#+END_SRC

*** Diagrama de Cron Jobs

#+BEGIN_SRC plantuml :file cron-automation.png :exports results
@startuml
!define SCHEDULE <<schedule>>

skinparam backgroundColor #FEFEFE

package "Automatizaci√≥n Semanal" {
    
    SCHEDULE "Domingo 3:00 AM" as sunday
    
    rectangle "weekly_deploy.sh" as deploy {
        activity "1. Crear backup" as backup
        activity "2. Verificar cambios Git" as check
        activity "3. Regenerar Hugo" as hugo
        activity "4. Git commit" as commit
        activity "5. Git push" as push
        activity "6. Log resultado" as log
    }
    
    sunday --> backup
    backup --> check
    check --> hugo
    hugo --> commit
    commit --> push
    push --> log
    
    note right of backup
      Backup autom√°tico
      /mnt/backup/album_familiar_auto_*.tar.gz
      Limpia backups >30 d√≠as
    end note
    
    note right of push
      GitHub Actions despliega
      autom√°ticamente despu√©s
      del push
    end note
}

package "Limpieza Mensual" {
    SCHEDULE "D√≠a 1 del mes 4:00 AM" as monthly
    
    rectangle "Limpieza de Logs" as cleanup {
        activity "Eliminar logs >90 d√≠as" as clean
    }
    
    monthly --> clean
}

@enduml
#+END_SRC

#+RESULTS:
[[file:cron-automation.png]]

** Monitoreo de Ejecuciones

*** Ver Logs de Deployment Autom√°tico

#+BEGIN_SRC bash
# Ver √∫ltimos deployments
tail -100 ~/album_familiar/logs/weekly_deploy.log

# Ver solo inicios de proceso
grep "Iniciando deployment" ~/album_familiar/logs/weekly_deploy.log

# Ver si hubo errores
grep -i "error\|fail" ~/album_familiar/logs/weekly_deploy.log
#+END_SRC

*** Verificar Ejecuci√≥n de Cron

#+BEGIN_SRC bash
# Ver ejecuciones recientes de cron
grep CRON /var/log/syslog | grep album_familiar | tail -20

# Ver estado del servicio cron
sudo systemctl status cron
#+END_SRC

* Despliegue en GitHub Pages

** 1. Crear Repositorio en GitHub

1. Ir a: https://github.com/new
2. Nombre: =recuerdos-familia=
3. Privacidad: Privado (recomendado)
4. NO inicializar con README

** 2. Configurar GitHub Pages

1. Settings ‚Üí Pages
2. Source: *GitHub Actions*
3. Guardar

** 3. Actualizar config.toml

#+BEGIN_SRC toml
baseURL = "https://mcasrom.github.io/recuerdos-familia/"
languageCode = "es-es"
title = "√Ålbum Familiar"

[params]
  description = "√Ålbum fotogr√°fico familiar privado"
  author = "Familia"
#+END_SRC

** 4. Inicializar Git y Push

#+BEGIN_SRC bash
cd ~/album_familiar

# Configurar Git
git config --global user.name "mcasrom"
git config --global user.email "tu_email@ejemplo.com"

# Inicializar repo
git init
git add .
git commit -m "Initial commit: √Ålbum Familiar"
git branch -M main

# Conectar con GitHub
git remote add origin https://github.com/mcasrom/recuerdos-familia.git

# Push inicial (pedir√° token)
git push -u origin main
#+END_SRC

** 5. Autenticaci√≥n con Token

1. GitHub ‚Üí Settings ‚Üí Developer settings
2. Personal access tokens ‚Üí Tokens (classic)
3. Generate new token
4. Scopes: =repo= + =workflow=
5. Copiar token =ghp_...=
6. En push: User: =mcasrom=, Password: =[token]=

** 6. Verificar Deployment

#+BEGIN_EXAMPLE
https://github.com/mcasrom/recuerdos-familia/actions
#+END_EXAMPLE

Esperar 3-5 minutos hasta ver ‚úÖ

** 7. Acceder al √Ålbum

#+BEGIN_EXAMPLE
URL: https://mcasrom.github.io/recuerdos-familia/
Password: Recuerdos@FAMILIA#
#+END_EXAMPLE

** Flujo de GitHub Actions

#+BEGIN_SRC plantuml :file github-actions-flow.png :exports results
@startuml
skinparam backgroundColor #FEFEFE

start

:Push a branch main;

partition "GitHub Actions Workflow" {
    :Checkout c√≥digo;
    :Instalar Hugo CLI v0.122.0;
    :Configurar GitHub Pages;
    
    :Generar sitio con Hugo\n--minify\n--baseURL;
    
    if (Build exitoso?) then (s√≠)
        :Upload artifact (public/);
        :Deploy to GitHub Pages;
        
        :‚úì Sitio desplegado;
        
        note right
            Disponible en:
            https://mcasrom.github.io/
            recuerdos-familia/
        end note
        
    else (no)
        :‚úó Error en build;
        :Notificar error;
        stop
    endif
}

:Usuario accede al sitio;
:Ingresa password;
:‚úì Ve √°lbum con 77 fotos;

stop
@enduml
#+END_SRC

#+RESULTS:
[[file:github-actions-flow.png]]

* Sistema de Backup

** Backup Manual

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/backup_album.sh
#+END_SRC

*** Contenido del Backup

El backup incluye:
- ‚úÖ Todos los archivos de contenido
- ‚úÖ Im√°genes optimizadas
- ‚úÖ Scripts
- ‚úÖ Templates y configuraci√≥n
- ‚úÖ Checksums MD5 y SHA256
- ‚ùå Excluye: =public/=, =.git/=, =node_modules/=

*** Ubicaci√≥n

#+BEGIN_EXAMPLE
/mnt/backup/album_familiar_YYYYMMDD_HHMMSS.tar.gz
#+END_EXAMPLE

*** Verificaci√≥n de Integridad

Cada backup incluye:

#+BEGIN_SRC bash
# Dentro del backup
checksums.md5      # Checksums MD5 de todos los archivos
checksums.sha256   # Checksums SHA256
file_list.txt      # Inventario completo
backup_info.txt    # Informaci√≥n del backup
#+END_SRC

** Backup Autom√°tico

El script =weekly_deploy.sh= crea backups autom√°ticos cada domingo a las 3:00 AM.

*** Retenci√≥n de Backups

| Tipo de Backup     | Retenci√≥n | Ubicaci√≥n                    |
|--------------------+-----------+------------------------------|
| Manual             | 30 d√≠as   | /mnt/backup/album_*.tar.gz   |
| Autom√°tico semanal | 30 d√≠as   | /mnt/backup/album_auto_*.tar.gz |

** Restaurar desde Backup

#+BEGIN_SRC bash
# 1. Ir al directorio home
cd ~

# 2. Restaurar backup
tar -xzf /mnt/backup/album_familiar_20260214_030000.tar.gz

# 3. Verificar integridad
cd album_familiar
md5sum -c checksums.md5
sha256sum -c checksums.sha256

# 4. Regenerar sitio
hugo --cleanDestinationDir
#+END_SRC

* Soluci√≥n de Problemas

** Tabla de Errores Comunes

| Error                        | Causa                      | Soluci√≥n                              |
|------------------------------+----------------------------+---------------------------------------|
| Password no funciona (local) | crypto.subtle bloqueado    | Ya resuelto con SHA-256 puro JS       |
| CSS/JS no cargan (GitHub)    | Rutas relativas incorrectas| Ya resuelto con .Site.BaseURL         |
| Foto muy grande              | Archivo > 25MB             | Redimensionar antes de subir          |
| EXIF corrupto                | Metadata inv√°lida          | Script usa fecha del archivo          |
| Hugo error "theme not found" | theme="" en config         | Ya eliminado del config.toml          |
| Git push falla               | Token expirado             | Regenerar token en GitHub             |
| Batch solo procesa 1 foto    | Bucle while con find       | Ya corregido a bucle for              |

** Logs Disponibles

#+BEGIN_SRC bash
# Gesti√≥n de fotos
tail -f ~/album_familiar/logs/management.log

# Optimizaci√≥n de im√°genes
tail -f ~/album_familiar/logs/optimization.log

# Deployments
tail -f ~/album_familiar/logs/deployment.log

# Backups
tail -f ~/album_familiar/logs/backup.log

# Deployment autom√°tico semanal
tail -f ~/album_familiar/logs/weekly_deploy.log
#+END_SRC

** Comandos de Diagn√≥stico

#+BEGIN_SRC bash
# Verificar Hugo
hugo version

# Ver configuraci√≥n actual
cat ~/album_familiar/config.toml

# Contar fotos procesadas
find ~/album_familiar/static/images -name "*_full.jpg" | wc -l

# Ver espacio usado
du -sh ~/album_familiar/static/images/

# Verificar Git status
cd ~/album_familiar && git status

# Probar generaci√≥n local
cd ~/album_familiar && hugo --cleanDestinationDir
#+END_SRC

* Scripts Disponibles

** Tabla de Scripts

| Script                | Ubicaci√≥n                 | Funci√≥n                           | Uso                    |
|-----------------------+---------------------------+-----------------------------------+------------------------|
| =setup.sh=            | ~/album_familiar/         | Instalaci√≥n inicial completa      | Una vez                |
| =manage_photos.sh=    | scripts/                  | Gesti√≥n individual de fotos       | Interactivo            |
| =batch_upload.sh=     | scripts/                  | Procesamiento masivo              | Por carpetas           |
| =deploy.sh=           | scripts/                  | Despliegue manual a GitHub        | Cuando necesites       |
| =backup_album.sh=     | scripts/                  | Backup manual                     | Cuando necesites       |
| =weekly_deploy.sh=    | scripts/                  | Deployment + backup autom√°tico    | Cron (Domingos 3 AM)   |

** Referencia R√°pida de Comandos

*** Gesti√≥n Individual

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/manage_photos.sh

# Opciones:
# 1. Subir foto
# 2. Eliminar foto
# 3. Editar foto
# 4. Ver estad√≠sticas
# 5. Generar sitio Hugo
# 6. Salir
#+END_SRC

*** Procesamiento Masivo

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/batch_upload.sh

# Inputs requeridos:
# - Carpeta: fotos_para_subir/2024/evento
# - T√≠tulo base: Nombre del Evento
# - Descripci√≥n: Descripci√≥n com√∫n
# - Confirmar: s
#+END_SRC

*** Despliegue Manual

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/deploy.sh

# Proceso:
# 1. Genera sitio con Hugo
# 2. Git add + commit + push
# 3. GitHub Actions despliega autom√°ticamente
#+END_SRC

*** Backup Manual

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/backup_album.sh

# Resultado:
# /mnt/backup/album_familiar_YYYYMMDD_HHMMSS.tar.gz
#+END_SRC

* Configuraci√≥n Avanzada

** Cambiar Contrase√±as

*** Calcular Hash SHA-256

#+BEGIN_SRC bash
# Para nueva contrase√±a
echo -n "TuNuevaContrase√±a123" | sha256sum
# Resultado: abc123def456... -
#+END_SRC

*** Actualizar auth.js

#+BEGIN_SRC bash
nano ~/album_familiar/static/js/auth.js

# Cambiar l√≠nea 3:
const PASSWORD_HASH = 'NUEVO_HASH_AQUI';

# Guardar y regenerar
cd ~/album_familiar
rm -rf public/
hugo --cleanDestinationDir
git add static/js/auth.js
git commit -m "Update: Nueva contrase√±a"
git push
#+END_SRC

** Personalizar Apariencia

*** Colores y Estilos

#+BEGIN_SRC bash
nano ~/album_familiar/static/css/style.css

# Variables principales:
# --primary-color: #3498db
# --secondary-color: #2c3e50
# --accent-color: #e74c3c
#+END_SRC

*** Placeholder de Thumbnails

#+BEGIN_SRC bash
cd ~/album_familiar/static/images

# Crear nuevo placeholder
convert -size 400x300 \
  gradient:"#COLOR1-#COLOR2" \
  -gravity center \
  -fill white \
  -pointsize 28 \
  -annotate +0+0 "Tu Texto" \
  placeholder.jpg
#+END_SRC

** Optimizaci√≥n de Rendimiento

*** Ajustar Calidad de Compresi√≥n

Editar =scripts/manage_photos.sh= y =scripts/batch_upload.sh=:

#+BEGIN_SRC bash
# L√≠neas de configuraci√≥n
JPEG_QUALITY=85     # 85 = Recomendado (calidad/tama√±o)
                    # 90 = M√°s calidad, m√°s peso
                    # 80 = Menos calidad, menos peso
#+END_SRC

*** Cambiar Resoluciones

#+BEGIN_SRC bash
# En manage_photos.sh y batch_upload.sh
MAX_WIDTH=1920      # Ancho m√°ximo full
MAX_HEIGHT=1080     # Alto m√°ximo full
THUMB_WIDTH=400     # Ancho thumbnail
THUMB_HEIGHT=300    # Alto thumbnail
#+END_SRC

** Configurar Notificaciones por Email

#+BEGIN_SRC bash
# Instalar mailutils
sudo apt install mailutils -y

# Configurar crontab
crontab -e

# Agregar al inicio
MAILTO=tu_email@ejemplo.com

# Los errores de cron se enviar√°n por email
#+END_SRC

* Tabla de Comandos de Referencia R√°pida

| Acci√≥n                    | Comando                                     |
|---------------------------+---------------------------------------------|
| Subir foto individual     | =./scripts/manage_photos.sh=                |
| Subir m√∫ltiples fotos     | =./scripts/batch_upload.sh=                 |
| Ver sitio local           | =hugo server -D --bind 0.0.0.0=             |
| Generar sitio             | =hugo --cleanDestinationDir=                |
| Desplegar a GitHub        | =./scripts/deploy.sh=                       |
| Hacer backup              | =./scripts/backup_album.sh=                 |
| Ver logs                  | =tail -f logs/management.log=               |
| Contar fotos              | =find static/images -name "*_full.jpg" \| wc -l= |
| Ver espacio usado         | =du -sh static/images/=                     |
| Limpiar builds            | =rm -rf public/ resources/=                 |
| Ver crontab               | =crontab -l=                                |
| Editar crontab            | =crontab -e=                                |
| Ver acciones GitHub       | https://github.com/USER/REPO/actions        |

* Diagrama de Estados del Sistema

#+BEGIN_SRC plantuml :file system-states.png :exports results
@startuml
skinparam backgroundColor #FEFEFE

[*] --> Instalado : setup.sh

Instalado --> FotosSubidas : manage_photos.sh\nbatch_upload.sh

FotosSubidas --> SitioLocal : hugo server

FotosSubidas --> SitioGenerado : hugo build

SitioLocal --> FotosSubidas : Ctrl+C

SitioGenerado --> EnGitHub : git push

EnGitHub --> Desplegado : GitHub Actions\n(3-5 min)

Desplegado --> Publicado : GitHub Pages\n(1-2 min)

Publicado --> [*]

FotosSubidas --> Respaldado : backup_album.sh

note right of Publicado
  https://mcasrom.github.io/recuerdos-familia/
  Password: Recuerdos@FAMILIA#
  Accesible desde cualquier navegador
end note

note left of Respaldado
  /mnt/backup/
  Retenci√≥n: 30 d√≠as
  Con checksums
end note

@enduml
#+END_SRC

#+RESULTS:
[[file:system-states.png]]

* Informaci√≥n de Contacto y Soporte

** Recursos

- *Documentaci√≥n Hugo*: https://gohugo.io/documentation/
- *GitHub Pages*: https://pages.github.com/
- *ImageMagick*: https://imagemagick.org/

** Archivos de Documentaci√≥n

| Archivo                         | Descripci√≥n                           |
|---------------------------------+---------------------------------------|
| =README.md=                     | Documentaci√≥n principal               |
| =HOWTO.md=                      | Gu√≠a de referencia r√°pida             |
| =INSTRUCCIONES.txt=             | Inicio r√°pido visual                  |
| =GUIA_STORAGE_FOTOS.txt=        | C√≥mo y d√≥nde colocar fotos            |
| =GUIA_FORMATOS_IMAGEN.txt=      | Formatos soportados                   |
| =ALBUM_FAMILIAR_DOCUMENTATION.org= | Este documento (formato Org)          |
| =TODO.org=                      | Lista de tareas y mejoras             |

** Versi√≥n del Sistema

| Componente              | Versi√≥n       |
|-------------------------+---------------|
| Documentaci√≥n           | 1.0           |
| Fecha                   | 2026-02-14    |
| Sistema Operativo       | DietPi        |
| Hugo                    | 0.122.0       |
| Estado                  | Producci√≥n ‚úÖ |

#+BEGIN_QUOTE
*Nota Final*: Este sistema ha sido dise√±ado para ser robusto, autom√°tico y f√°cil de usar. 
El deployment semanal autom√°tico asegura que tus fotos se mantengan respaldadas y publicadas 
sin intervenci√≥n manual. ¬°Disfruta de tu √°lbum familiar! üì∏‚ú®
#+END_QUOTE

* COMMENT Local Variables
# Local Variables:
# org-confirm-babel-evaluate: nil
# End:
