#+TITLE: √Ålbum Familiar - Sistema de Gesti√≥n Fotogr√°fica
#+AUTHOR: Administrador del Sistema
#+DATE: 2026-02-14
#+OPTIONS: toc:3 num:t ^:nil
#+STARTUP: overview
#+PROPERTY: header-args :results output :exports both

* Resumen Ejecutivo

Sistema de √°lbum fotogr√°fico familiar optimizado para Odroid CE con DietPi, 
generador est√°tico Hugo, despliegue en GitHub Pages con autenticaci√≥n por 
contrase√±a y gesti√≥n administrativa completa.

** Caracter√≠sticas Principales
- üîê Sistema dual de autenticaci√≥n (visualizaci√≥n/administraci√≥n)
- üì∏ Optimizaci√≥n autom√°tica de im√°genes para hardware limitado
- üìÖ Organizaci√≥n temporal (a√±os/meses/fechas)
- üîç Filtrado por rangos de fechas
- üé® Interfaz responsive optimizada
- ‚ö° Generaci√≥n est√°tica con Hugo
- üåê Despliegue autom√°tico en GitHub Pages

* TODO Lista de Tareas [0/8]
- [ ] Instalar dependencias en Odroid
- [ ] Ejecutar script de instalaci√≥n
- [ ] Configurar repositorio GitHub
- [ ] Configurar GitHub Pages
- [ ] Subir primeras fotograf√≠as de prueba
- [ ] Validar optimizaci√≥n de im√°genes
- [ ] Probar sistema de autenticaci√≥n
- [ ] Documentar proceso de backup

* Arquitectura del Sistema

** Diagrama de Arquitectura General

#+BEGIN_SRC plantuml :file arquitectura_general.png
@startuml
!theme cerulean-outline

skinparam componentStyle rectangle

package "Odroid CE (DietPi)" {
  [Hugo Static Generator] as hugo
  [Script de Gesti√≥n] as script
  [Optimizador Im√°genes] as optimizer
  
  folder "~/album_familiar" {
    folder "content/fotos" as content
    folder "static/images" as images
    folder "themes/album-theme" as theme
  }
}

cloud "GitHub" {
  [Repositorio Git] as repo
  [GitHub Pages] as pages
}

actor "Usuario Visitante" as user
actor "Administrador" as admin

user --> pages : Visualiza\nPassword: Recuerdos@FAMILIA#
admin --> script : Gestiona\nPassword: recuerditos@familia
script --> optimizer : Optimiza im√°genes
optimizer --> images : Guarda optimizadas
script --> content : Genera contenido
content --> hugo : Lee contenido
hugo --> repo : Push autom√°tico
repo --> pages : Deploy

note right of optimizer
  - Redimensiona a max 1920x1080
  - Compresi√≥n JPEG 85%
  - Genera thumbnails 400x300
  - Valida tama√±os excesivos
  - Rotaci√≥n EXIF autom√°tica
end note

@enduml
#+END_SRC

** Diagrama de Flujo de Gesti√≥n de Fotos

#+BEGIN_SRC plantuml :file flujo_gestion_fotos.png
@startuml
!theme vibrant

start

:Admin ejecuta script gesti√≥n;

if (¬øAcci√≥n?) then (subir)
  :Selecciona archivo(s);
  :Lee EXIF metadata;
  
  if (¬øTama√±o > 10MB?) then (s√≠)
    :Muestra advertencia;
    :¬øContinuar?;
    if (no) then
      stop
    endif
  endif
  
  :Detecta rotaci√≥n EXIF;
  :Aplica rotaci√≥n;
  :Redimensiona a 1920x1080;
  :Comprime a JPEG 85%;
  :Genera thumbnail 400x300;
  :Extrae fecha de EXIF;
  :Organiza por a√±o/mes;
  :Genera archivo Markdown;
  :Actualiza √≠ndices;
  
elseif (borrar) then
  :Lista fotos existentes;
  :Selecciona foto;
  :Confirma eliminaci√≥n;
  :Elimina archivos;
  :Actualiza √≠ndices;
  
elseif (editar) then
  :Selecciona foto;
  :Edita t√≠tulo/descripci√≥n;
  :Actualiza metadata;
  :Regenera p√°gina;
  
elseif (generar) then
  :Ejecuta Hugo build;
  :Publica en GitHub;
endif

:Fin de operaci√≥n;

stop

@enduml
#+END_SRC

** Diagrama de Estructura de Directorios

#+BEGIN_SRC plantuml :file estructura_directorios.png
@startuml
@startsalt
{
{T
+ ~/album_familiar
++ archetypes
+++ default.md
++ content
+++ _index.md
+++ fotos
++++ 2024
+++++ 01-enero
++++++ foto1.md
++++++ foto2.md
+++++ 02-febrero
++++ 2025
+++++ 01-enero
++ layouts
+++ _default
++++ baseof.html
++++ list.html
++++ single.html
+++ partials
++++ header.html
++++ footer.html
++++ auth.html
++ static
+++ css
++++ style.css
+++ js
++++ auth.js
++++ gallery.js
++++ date-filter.js
+++ images
++++ 2024
+++++ 01
++++++ foto1_full.jpg
++++++ foto1_thumb.jpg
++++ 2025
+++ admin
++++ admin.html
++ scripts
+++ setup.sh
+++ manage_photos.sh
+++ optimize_image.sh
+++ deploy.sh
++ config.toml
++ README.org
}
}
@endsalt
@enduml
#+END_SRC

** Diagrama de Clases (Estructura de Datos)

#+BEGIN_SRC plantuml :file diagrama_clases.png
@startuml
!theme sketchy-outline

class Foto {
  -String titulo
  -String descripcion
  -Date fecha_captura
  -Date fecha_subida
  -String ruta_full
  -String ruta_thumbnail
  -Int ancho_original
  -Int alto_original
  -Int peso_original_kb
  -Int peso_optimizado_kb
  -String camara
  -Float latitud
  -Float longitud
  +optimizar()
  +generar_thumbnail()
  +extraer_exif()
  +rotar_segun_exif()
}

class Album {
  -String nombre
  -String password_visualizacion
  -String password_admin
  -List<Foto> fotos
  -Date fecha_creacion
  +agregar_foto(Foto)
  +eliminar_foto(id)
  +filtrar_por_fecha(inicio, fin)
  +generar_html()
  +desplegar_github()
}

class Mes {
  -Int numero
  -String nombre
  -Int a√±o
  -List<Foto> fotos
  +contar_fotos()
  +obtener_portada()
}

class A√±o {
  -Int numero
  -List<Mes> meses
  -Int total_fotos
  +agregar_mes(Mes)
  +estadisticas()
}

Album "1" *-- "*" Foto
A√±o "1" *-- "*" Mes
Mes "1" *-- "*" Foto

@enduml
#+END_SRC

* Especificaciones T√©cnicas

** Hardware: Odroid CE con DietPi

*** Optimizaciones espec√≠ficas
- Im√°genes m√°ximo 1920x1080 (Full HD)
- Thumbnails 400x300 p√≠xeles
- Compresi√≥n JPEG 85% calidad
- Lazy loading de im√°genes
- Generaci√≥n est√°tica sin procesamiento din√°mico

*** Recursos requeridos
#+BEGIN_SRC conf
CPU: ARM Cortex (cualquier modelo Odroid CE)
RAM: M√≠nimo 512MB (recomendado 1GB)
Almacenamiento: M√≠nimo 8GB (recomendado 32GB)
Sistema: DietPi (Debian-based)
#+END_SRC

** Software Stack

*** Dependencias principales
#+BEGIN_SRC bash
# Sistema operativo
DietPi (Debian 11/12 based)

# Generador est√°tico
Hugo Extended v0.120+

# Procesamiento de im√°genes
ImageMagick 7.x
ExifTool
JpegOptim
OptiPNG

# Control de versiones
Git 2.x

# Lenguajes/Scripts
Bash 5.x
Python 3.9+
#+END_SRC

** Autenticaci√≥n

*** Sistema dual de passwords

#+BEGIN_SRC javascript
// Password de visualizaci√≥n (p√∫blico familiar)
const PASSWORD_VIEW = "Recuerdos@FAMILIA#";

// Password de administraci√≥n (gesti√≥n)
const PASSWORD_ADMIN = "recuerditos@familia";
#+END_SRC

*** Implementaci√≥n
- Autenticaci√≥n client-side mediante JavaScript
- Hash SHA-256 de passwords
- Session storage para mantener sesi√≥n
- Protecci√≥n de rutas administrativas
- Logout autom√°tico tras inactividad

* Instalaci√≥n y Configuraci√≥n

** PASO 1: Preparaci√≥n del Sistema

#+BEGIN_SRC bash :tangle instalacion.sh
#!/bin/bash
# Actualizar sistema DietPi
sudo apt update && sudo apt upgrade -y

# Instalar dependencias
sudo apt install -y \
  git \
  imagemagick \
  libimage-exiftool-perl \
  jpegoptim \
  optipng \
  python3-pip \
  python3-pil

# Instalar Hugo Extended
HUGO_VERSION="0.122.0"
wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-arm64.deb
sudo dpkg -i hugo_extended_${HUGO_VERSION}_linux-arm64.deb
rm hugo_extended_${HUGO_VERSION}_linux-arm64.deb

# Verificar instalaci√≥n
hugo version
#+END_SRC

** PASO 2: Ejecutar Script de Setup

#+BEGIN_SRC bash
cd ~
bash ~/album_familiar/scripts/setup.sh
#+END_SRC

** PASO 3: Configurar GitHub

*** Crear repositorio
#+BEGIN_SRC bash
# En GitHub web:
# 1. Crear repositorio "album-familiar"
# 2. Settings > Pages > Source: GitHub Actions
# 3. Generar Personal Access Token (classic)
#    - repo (all)
#    - workflow
#+END_SRC

*** Configurar repositorio local
#+BEGIN_SRC bash
cd ~/album_familiar
git remote add origin https://github.com/TU_USUARIO/album-familiar.git
git branch -M main
git push -u origin main
#+END_SRC

** PASO 4: Configurar Despliegue Autom√°tico

El archivo ~.github/workflows/hugo.yml~ ya est√° incluido y configurado.

* Uso del Sistema

** Gesti√≥n Administrativa

*** Subir nuevas fotograf√≠as

#+BEGIN_SRC bash
cd ~/album_familiar
./scripts/manage_photos.sh
# Seleccionar opci√≥n 1: Subir fotograf√≠a
# Ingresar password admin: recuerditos@familia
# Seleccionar archivo(s)
# El script autom√°ticamente:
#   - Optimiza la imagen
#   - Extrae EXIF
#   - Organiza por fecha
#   - Genera entrada Markdown
#+END_SRC

*** Eliminar fotograf√≠as

#+BEGIN_SRC bash
./scripts/manage_photos.sh
# Opci√≥n 2: Eliminar fotograf√≠a
# Listar fotos existentes
# Seleccionar por ID
# Confirmar eliminaci√≥n
#+END_SRC

*** Editar metadatos

#+BEGIN_SRC bash
./scripts/manage_photos.sh
# Opci√≥n 3: Editar fotograf√≠a
# Modificar t√≠tulo/descripci√≥n
# Actualizar fecha si necesario
#+END_SRC

*** Generar y desplegar

#+BEGIN_SRC bash
./scripts/deploy.sh
# Genera sitio est√°tico
# Commit y push a GitHub
# GitHub Actions despliega autom√°ticamente
#+END_SRC

** Acceso de Usuarios

*** URL del √°lbum
#+BEGIN_SRC
https://TU_USUARIO.github.io/album-familiar/
#+END_SRC

*** Password de acceso
#+BEGIN_SRC
Recuerdos@FAMILIA#
#+END_SRC

*** Funcionalidades disponibles
- Ver fotos organizadas por a√±o/mes
- Filtrar por rango de fechas
- Ver en modo galer√≠a o lista
- Descargar fotos individuales
- Vista de foto completa con zoom

* Filtrado por Fechas

** Interfaz de usuario

La p√°gina principal incluye:
- Selectores de a√±o (desde-hasta)
- Selectores de mes (desde-hasta)
- Bot√≥n "Filtrar"
- Bot√≥n "Limpiar filtros"

** Ejemplos de uso

#+BEGIN_EXAMPLE
Filtrar fotos de 2024:
  Desde: Enero 2024
  Hasta: Diciembre 2024

Filtrar verano 2024:
  Desde: Junio 2024
  Hasta: Agosto 2024

Filtrar √∫ltimo a√±o:
  Desde: Febrero 2025
  Hasta: Febrero 2026
#+END_EXAMPLE

* Optimizaci√≥n de Im√°genes

** Proceso autom√°tico

#+BEGIN_SRC plantuml :file proceso_optimizacion.png
@startuml
!theme toy

start

:Imagen original cargada;

if (¬øTama√±o > 10MB?) then (s√≠)
  :‚ö†Ô∏è Advertencia mostrada;
endif

:Lee orientaci√≥n EXIF;

if (¬øRequiere rotaci√≥n?) then (s√≠)
  :Rota imagen autom√°ticamente;
endif

:Redimensiona a max 1920x1080\n(mantiene aspect ratio);

:Comprime JPEG a 85% calidad;

:Guarda imagen optimizada;

fork
  :Genera thumbnail 400x300;
fork again
  :Extrae metadata EXIF;
end fork

:Guarda en estructura por fecha;

:Genera archivo Markdown;

stop

@enduml
#+END_SRC

** Configuraci√≥n de l√≠mites

#+BEGIN_SRC python
# En optimize_image.sh
MAX_WIDTH = 1920
MAX_HEIGHT = 1080
JPEG_QUALITY = 85
THUMB_WIDTH = 400
THUMB_HEIGHT = 300
WARNING_SIZE_MB = 10
MAX_SIZE_MB = 25  # Rechaza si supera
#+END_SRC

* Mantenimiento y Backup

** Backup recomendado

#+BEGIN_SRC bash
#!/bin/bash
# backup_album.sh

BACKUP_DIR="/mnt/backup/album_$(date +%Y%m%d)"
SOURCE_DIR="$HOME/album_familiar"

# Crear directorio de backup
mkdir -p "$BACKUP_DIR"

# Copiar todo el √°lbum
rsync -av --progress "$SOURCE_DIR/" "$BACKUP_DIR/"

# Comprimir
cd /mnt/backup
tar czf "album_$(date +%Y%m%d).tar.gz" "album_$(date +%Y%m%d)"
rm -rf "album_$(date +%Y%m%d)"

echo "‚úì Backup completado: album_$(date +%Y%m%d).tar.gz"
#+END_SRC

** Programar backups autom√°ticos

#+BEGIN_SRC bash
# Agregar a crontab
crontab -e

# Backup semanal los domingos a las 3 AM
0 3 * * 0 /home/dietpi/album_familiar/scripts/backup_album.sh
#+END_SRC

** Restauraci√≥n

#+BEGIN_SRC bash
# Extraer backup
cd /mnt/backup
tar xzf album_20260214.tar.gz

# Restaurar
rsync -av album_20260214/ ~/album_familiar/

# Verificar
cd ~/album_familiar
hugo server
#+END_SRC

* Soluci√≥n de Problemas

** Hugo no genera el sitio

#+BEGIN_SRC bash
# Verificar errores
cd ~/album_familiar
hugo --verbose

# Limpiar cache
hugo --cleanDestinationDir

# Regenerar
hugo
#+END_SRC

** Im√°genes no se muestran

#+BEGIN_SRC bash
# Verificar permisos
cd ~/album_familiar
find static/images -type f -exec chmod 644 {} \;
find static/images -type d -exec chmod 755 {} \;
#+END_SRC

** GitHub Pages no actualiza

#+BEGIN_SRC bash
# Verificar workflow
# En GitHub: Actions > Ver √∫ltimo run

# Forzar rebuild
cd ~/album_familiar
git commit --allow-empty -m "Trigger rebuild"
git push
#+END_SRC

** Password no funciona

#+BEGIN_SRC javascript
// Verificar hash en static/js/auth.js
// El hash debe coincidir exactamente

// Para generar nuevo hash:
echo -n "Recuerdos@FAMILIA#" | sha256sum
#+END_SRC

* Monitoreo y Estad√≠sticas

** Dashboard de estad√≠sticas

El √°lbum incluye una p√°gina de estad√≠sticas accesible solo con password admin:

- Total de fotograf√≠as
- Fotos por a√±o/mes
- Tama√±o total ocupado
- √öltimo upload
- C√°maras m√°s usadas
- Gr√°ficos de actividad

** Logs del sistema

#+BEGIN_SRC bash
# Ver logs de gesti√≥n
tail -f ~/album_familiar/logs/management.log

# Ver logs de optimizaci√≥n
tail -f ~/album_familiar/logs/optimization.log
#+END_SRC

* Roadmap y Mejoras Futuras

** Versi√≥n 1.0 (Actual)
- [X] Sistema de autenticaci√≥n dual
- [X] Optimizaci√≥n autom√°tica de im√°genes
- [X] Organizaci√≥n temporal
- [X] Filtrado por fechas
- [X] Despliegue GitHub Pages

** Versi√≥n 1.1 (Pr√≥xima)
- [ ] B√∫squeda por palabras clave
- [ ] Etiquetas/tags personalizados
- [ ] √Ålbumes tem√°ticos
- [ ] Comentarios en fotos
- [ ] Geolocalizaci√≥n en mapa

** Versi√≥n 2.0 (Futuro)
- [ ] Reconocimiento facial
- [ ] Detecci√≥n autom√°tica de duplicados
- [ ] Editor de fotos integrado
- [ ] Compartir √°lbumes espec√≠ficos
- [ ] App m√≥vil nativa

* Referencias y Recursos

** Documentaci√≥n oficial
- Hugo: https://gohugo.io/documentation/
- ImageMagick: https://imagemagick.org/
- GitHub Pages: https://docs.github.com/pages

** Comandos √∫tiles de referencia r√°pida

#+BEGIN_SRC bash
# Ver sitio localmente
cd ~/album_familiar && hugo server -D

# Subir foto r√°pida
./scripts/manage_photos.sh upload /ruta/foto.jpg

# Desplegar
./scripts/deploy.sh

# Backup manual
./scripts/backup_album.sh

# Ver estad√≠sticas de espacio
du -sh ~/album_familiar/static/images/*
#+END_SRC

* Licencia y Cr√©ditos

** Licencia
MIT License - Uso libre para fines personales y familiares

** Cr√©ditos
- Sistema creado para gesti√≥n familiar de fotograf√≠as
- Optimizado para Odroid CE con DietPi
- Generador: Hugo Static Site Generator
- Hosting: GitHub Pages

** Contacto y Soporte
Para reportar problemas o sugerencias, crear issue en el repositorio GitHub.

* Anexos

** A. Variables de Entorno

#+BEGIN_SRC bash
# ~/.bashrc
export ALBUM_DIR="$HOME/album_familiar"
export ALBUM_BACKUP_DIR="/mnt/backup/album"
export ALBUM_MAX_SIZE_MB=25
export ALBUM_JPEG_QUALITY=85
#+END_SRC

** B. Estructura de Archivo Markdown de Foto

#+BEGIN_SRC markdown
---
title: "Cumplea√±os de Mar√≠a"
date: 2024-03-15T14:30:00-06:00
description: "Celebraci√≥n del cumplea√±os n√∫mero 5"
image: "/images/2024/03/foto001_full.jpg"
thumbnail: "/images/2024/03/foto001_thumb.jpg"
camera: "Canon EOS R5"
focal_length: "50mm"
aperture: "f/2.8"
iso: 400
location: "Ciudad de M√©xico"
year: 2024
month: 3
weight: 1
---

Hermosa celebraci√≥n familiar en el jard√≠n.
#+END_SRC

** C. Configuraci√≥n de ImageMagick Policy

#+BEGIN_SRC xml
<!-- /etc/ImageMagick-7/policy.xml -->
<policymap>
  <policy domain="resource" name="memory" value="512MiB"/>
  <policy domain="resource" name="map" value="1GiB"/>
  <policy domain="resource" name="width" value="10KP"/>
  <policy domain="resource" name="height" value="10KP"/>
  <policy domain="resource" name="area" value="100MP"/>
  <policy domain="resource" name="disk" value="2GiB"/>
</policymap>
#+END_SRC

** D. Checklist de Pre-Deployment

#+BEGIN_EXAMPLE
‚òê Hugo instalado y funcionando
‚òê Dependencias de imagen instaladas
‚òê Repositorio GitHub creado
‚òê GitHub Pages configurado
‚òê Token de acceso generado
‚òê Passwords configurados en auth.js
‚òê Primera foto de prueba subida
‚òê Build local exitoso
‚òê Deploy de prueba exitoso
‚òê Verificaci√≥n de acceso con password
‚òê Backup inicial creado
#+END_EXAMPLE

#+BEGIN_CENTER
---
üì∏ *√Ålbum Familiar* - Sistema de Gesti√≥n Fotogr√°fica
Versi√≥n 1.0 | Febrero 2026
---
#+END_CENTER
